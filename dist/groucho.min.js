/*! Groucho - v0.2.1 - 2014-12-15
* https://github.com/tableau-mkt/groucho
* Copyright (c) 2014 Josh Lind; Licensed MIT */

var groucho=window.groucho||{};!function(a,b){b.config=b.config||{taxonomyProperty:"tags",trackExtent:50,favThreshold:1,trackProperties:["title","type","tags"],addons:{}},b.userDeferred=b.userDeferred||a.Deferred(),b.favoriteTerms=!1,a(document).ready(function(){b.trackOrigins(),b.trackHit()}),b.trackOrigins=function(){var c=(new Date).getTime(),d={timestamp:c,url:window.location.href};a.jStorage.get("user.session_origin")&&document.referrer||a.jStorage.set("user.session_origin",d),a.jStorage.get("user.origin")||(d.referrer=document.referrer,a.jStorage.set("user.origin",d)),b.userDeferred.resolve()},b.trackHit=function(){var a,c=new DataLayerHelper(dataLayer),d=b.config.trackProperties,e={url:window.location.href};if(typeof trackExtent!==!1&&"undefined"!=typeof dataLayer)for(a in d)"undefined"!=typeof c.get(d[a])&&(e[d[a]]=c.get(d[a]));b.createActivity("browsing",e)},b.createActivity=function(c,d){var e=b.getActivities(c),f=(new Date).getTime(),g=0;if(a.jStorage.set("track."+c+"."+f,d),e.length>=b.config.trackExtent){g=e.length-b.config.trackExtent;for(var h=0;g>=h;h++)a.jStorage.deleteKey(e[h]._key)}},b.getActivities=function(b){var c,d=a.jStorage.index(),e=[],f=new RegExp("^track."+b+".","g");for(var g in d)b?null!==d[g].match(f)&&(c=a.jStorage.get(d[g]),c._key=d[g],e.push(c)):(c=a.jStorage.get(d[g]),c._key=d[g],e.push(c));return e},b.getFavoriteTerms=function(a,c,d){function e(a,b){for(var c in j[b][k][a])m.hasOwnProperty(a)||(m[a]={}),m[a].hasOwnProperty(c)?m[a][c].count++:m[a][c]={name:j[b][k][a][c],count:1}}function f(a){var b=d;for(var c in m[a])m[a][c].count>=b&&(b=m[a][c].count);for(c in m[a])m[a][c].count<b&&delete m[a][c];h(m[a])&&delete m[a]}function g(a){var b=[];for(var c in a)a[c].id=c,b.push(a[c]);return b}function h(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}var i,j=b.getActivities("browsing"),k=b.config.taxonomyProperty,l=[],m={};if(a=a||"*",c=c||!1,d=d||b.config.favThreshold,"undefined"!=typeof k){for(var n in j)if("undefined"==typeof l[j[n].url]&&j[n].hasOwnProperty(k))if(l[j[n].url]=!0,"*"===a)for(i in j[n][k])e(i,n);else j[n][k].hasOwnProperty(a)&&e(a,n);if(!c)for(i in m)f(i);if("*"===a){for(i in m)m[i]=g(m[i]);c===!1&&(b.favoriteTerms=m)}else m=g(m[a])}return m}}(jQuery,groucho);