/*! Groucho - v0.2.3 - 2016-02-26
* https://github.com/tableau-mkt/groucho
* Copyright (c) 2016 Josh Lind; Licensed MIT */


var groucho=window.groucho||{};!function(a,b){var c={taxonomyProperty:"tags",trackExtent:50,favThreshold:1,trackProperties:["title","type","tags"],lastClicked:"a",addons:{}};for(var d in c)b.config.hasOwnProperty(d)||(b.config[d]=c[d]);b.userDeferred=b.userDeferred||a.Deferred(),b.favoriteTerms=!1,b.trackOrigins=function(){var a=(new Date).getTime(),c={timestamp:a,url:window.location.href};b.storage.get("user.sessionOrigin")&&document.referrer||b.storage.set("user.sessionOrigin",c),b.storage.get("user.origin")||(c.referrer=document.referrer,b.storage.set("user.origin",c)),b.userDeferred.resolve()},b.trackHit=function(){var a=new DataLayerHelper(dataLayer),c=b.config.trackProperties,d={url:window.location.href};if("undefined"!=typeof dataLayer)for(var e in c)c.hasOwnProperty(e)&&"undefined"!=typeof a.get(c[e])&&(d[c[e]]=a.get(c[e]));b.createActivity("browsing",d)},b.trackClicks=function(){b.config.lastClicked&&"function"===a.click&&a(b.config.lastClicked).click(function(){b.storage.set("user.lastClicked",a(this).text())})},b.createActivity=function(a,c){var d=b.getActivities(a),e=(new Date).getTime(),f=0;if(b.storage.set("track."+a+"."+e,c),d.length>=b.config.trackExtent){f=d.length-b.config.trackExtent;for(var g=0;f>=g;g++)b.storage.remove(d[g]._key)}},b.getActivities=function(a){var c,d=b.storage.index(),e=[],f=a?new RegExp("^track."+a+".","g"):!1;for(var g in d)d.hasOwnProperty(g)&&(a?null!==d[g].match(f)&&(c=b.storage.get(d[g]),c._key=d[g],e.push(c)):(c=b.storage.get(d[g]),c._key=d[g],e.push(c)));return e.sort(function(a,b){return parseInt(b._key.split(".")[2],10)>parseInt(a._key.split(".")[2],10)?-1:1}),e},b.getFavoriteTerms=function(a,c,d){function e(a,b){for(var c in j[b][k][a])m.hasOwnProperty(a)||(m[a]={}),m[a].hasOwnProperty(c)?m[a][c].count++:m[a][c]={name:j[b][k][a][c],count:1}}function f(a){var b=d;for(var c in m[a])m[a][c].count>=b&&(b=m[a][c].count);for(c in m[a])m[a][c].count<b&&delete m[a][c];h(m[a])&&delete m[a]}function g(a){var b=[];for(var c in a)a[c].id=c,b.push(a[c]);return b}function h(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}var i,j=b.getActivities("browsing"),k=b.config.taxonomyProperty,l=[],m={};if(a=a||"*",c=c||!1,d=d||b.config.favThreshold,"undefined"!=typeof k){for(var n in j)if(j.hasOwnProperty(n)&&"undefined"==typeof l[j[n].url]&&j[n].hasOwnProperty(k))if(l[j[n].url]=!0,"*"===a)for(i in j[n][k])e(i,n);else j[n][k].hasOwnProperty(a)&&e(a,n);if(!c)for(i in m)f(i);if("*"===a){for(i in m)m[i]=g(m[i]);c===!1&&(b.favoriteTerms=m)}else m=g(m[a])}return m},b.schema=function(){var a={"user.sessionOrigin":{oldKey:"user.session_origin",version:"0.2.0"}};for(var c in a)null===b.storage.get(c)&&null!==b.storage.get(a[c].oldKey)&&(b.storage.set(c,b.storage.set(a[c].oldKey)),b.storage.remove(a[c].oldKey))},a(document).ready(function(){b.schema(),b.trackOrigins(),b.trackHit(),b.trackClicks()})}(window.jQuery||window.Zepto||window.$,groucho);var groucho=window.groucho||{};!function(a,b){var c,d;d=function(){return console.log("No localStorage backend libary"),!1},b.storage||(c=a.hasOwnProperty("jStorage")&&"object"==typeof a.jStorage,b.storage={set:c?function(b,c){return a.jStorage.set(b,c)}:d,get:c?function(b){return a.jStorage.get(b)}:d,remove:c?function(b){return a.jStorage.deleteKey(b)}:d,index:c?function(){return a.jStorage.index()}:d,available:c?function(){return a.jStorage.storageAvailable()}:d,clear:c?function(){return a.jStorage.flush()}:d})}(window.jQuery||window.Zepto||window.$,groucho);
//# sourceMappingURL=dist/groucho.map